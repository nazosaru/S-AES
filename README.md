> 目录
- [编程与测试要求](#编程与测试要求)
- [开发手册](#开发手册)
  - [算法说明](#算法说明) 
  - [接口说明](#接口说明)
- [用户指南](#用户指南)
  - [概述](#概述)
  - [操作指南](#操作指南)

# 编程与测试要求  
- 第一关-基本测试

  根据S-AES算法编写和调试程序，提供GUI解密支持用户交互。输入可以是16bit的数据和16bit的密钥，输出是16bit的密文。

- 第二关-交叉测试 

  考虑到是"算法标准"，所有人在编写程序的时候需要使用相同算法流程和转换单元(替换盒、列混淆矩阵等)，以保证算法和程序在异构的系统或平台上都可以正常运行。
  设有A和B两组位同学(选择相同的密钥K)；则A、B组同学编写的程序对明文P进行加密得到相同的密文C；或者B组同学接收到A组程序加密的密文C，使用B组程序进行解密可得到与A相同的P。

- 第三关-扩展功能  

  考虑到向实用性扩展，加密算法的数据输入可以是ASII编码字符串(分组为2 Bytes)，对应地输出也可以是ACII字符串(很可能是乱码)。

- 第四关-多重加密 

  4.1 双重加密
  将S-AES算法通过双重加密进行扩展，分组长度仍然是16 bits，但密钥长度为32 bits。

  4.2 中间相遇攻击
  假设你找到了使用相同密钥的明、密文对(一个或多个)，请尝试使用中间相遇攻击的方法找到正确的密钥Key(K1+K2)。

  4.3 三重加密

  将S-AES算法通过三重加密进行扩展，下面两种模式选择一种完成：

  (1)按照32 bits密钥Key(K1+K2)的模式进行三重加密解密，

  (2)使用48bits(K1+K2+K3)的模式进行三重加解密。

- 第五关-工作模式  

  基于S-AES算法，使用密码分组链(CBC)模式对较长的明文消息进行加密。注意初始向量(16 bits) 的生成，并需要加解密双方共享。
  在CBC模式下进行加密，并尝试对密文分组进行替换或修改，然后进行解密，请对比篡改密文前后的解密结果。

# 开发手册
## 算法说明
- 密钥生成

  16位初始密钥先被分为两个8位字，再由最初的两位字计算新4个字。

  将第一个字与经过g运算的第二个字按位异或得到第三个字，第三个字与第二个字按位异或得到第四个字。

  g运算：将8位分成左右各4位，左右交换，然后各自用S盒进行替换，最后与轮常数按位异或。

  轮常数RCON: RC[i]=x^(i+2),RC[1]=x^3=100,RC[2]=x^4mod(x^4+x+1)=x+1=0011,RCON[1]=1000 0000,RCON[2]=0011 0000 。

- 轮密钥加（A(k)）

  将16位密钥与明文按位异或，其逆运算为本身。

- 半字节替换（NS）

  规定一个S盒，将每个半字节按照以下方式替换到一个新的半字节：半字节的最左侧2位作为行值，右侧2位作为列值。

  其逆运算（INS)为使用逆S盒进行替换。
  
- 行移位（SR）

  将16-bit数据的第 5 到 8 位与第 13 到 16 位进行置换。

  其逆运算（ISR）相同。

- 列混淆（MC）

  进行一个GF(2^4)上的矩阵运算，将各位进行替换,其中的加法与乘法运算可通过查表获得结果。

  逆运算（IMC)算法相同，只是矩阵为逆矩阵。

- 加密算法

  A(k2)·SR·NS·A(k1)·MC·SR·NS·A(k0)

- 解密算法

  A(k0)·INS·ISR·IMC·A(k1)·INS·ISR·A(k2)

- ASCII加解密

  ASCII码是由8bit表示的，只需将每两个字符放入加密算法即可，但由于ASCII码最高位空余，所以结果转化为字符会乱码，我们就保留了转化前的结果。

- 多重加密

  - 双重加密与中间相遇攻击

    1.选择一对密钥进行加解密。

    2.对明文进行加密，对密文进行解密，中间结果相等时即为一对密钥。

  - 三重加密

    使用48bits(K1+K2+K3)的模式进行三重加解密。

- 工作模式

  使用密码分组链(CBC)模式对较长的明文消息进行加密，初始向量由用户（加密通信双方）生成并共享。

## 接口说明

### `S_AES.h`中封装的函数

#### 1. `int B_to_D(int *binary, int begin, int end)`
- **功能**: 将 `binary` 数组中从 `begin` 到 `end` 的二进制数转换为十进制数。
- **参数**:
  - `binary`: 存储二进制数的一维数组。
  - `begin`: 起始索引（包含）。
  - `end`: 结束索引（包含）。
- **返回值**: 对应的十进制数。

---

#### 2. `void D_to_B(int decimal, int *binary, int begin, int end)`
- **功能**: 将十进制数 `decimal` 转换为二进制，并存储在 `binary` 数组中从 `begin` 到 `end` 的索引位置。
- **参数**:
  - `decimal`: 要转换的十进制数。
  - `binary`: 存储转换后结果的一维数组。
  - `begin`: 起始索引（包含）。
  - `end`: 结束索引（包含）。
 
---

#### 3. `void arrPrint(int *a, int begin, int end, bool mode)`
- **功能**: 打印数组 `a` 中从 `begin` 到 `end` 的元素，支持二进制或十六进制输出。
- **参数**:
  - `a`: 要打印的数组。
  - `begin`: 起始索引（包含）。
  - `end`: 结束索引（包含）。
  - `mode`: 输出模式，`false` 表示二进制，`true` 表示十六进制。
 
---

#### 4. `void addRoundKey(int *mingwen, int *key)`
- **功能**: 对 `mingwen`（明文）与 `key`（密钥）进行轮密钥加。
- **参数**:
  - `mingwen`: 明文数组。
  - `key`: 密钥数组。
 
---

#### 5. `void subBytes(int *state, int begin, int end)`
- **功能**: 对 `state` 数组中从 `begin` 到 `end` 的部分进行字节替代（S-Box替换）。
- **参数**:
  - `state`: 状态数组。
  - `begin`: 起始索引（包含）。
  - `end`: 结束索引（包含）。
 
---

#### 6. `void invSubBytes(int *state, int begin, int end)`
- **功能**: 对 `state` 数组中从 `begin` 到 `end` 的部分进行逆字节替代（逆S-Box替换）。
- **参数**:
  - `state`: 状态数组。
  - `begin`: 起始索引（包含）。
  - `end`: 结束索引（包含）。
 
---

#### 7. `void shiftRows(int *state)`
- **功能**: 对 `state` 数组进行行移位操作。
- **参数**:
  - `state`: 状态数组。
 
---

#### 8. `void mixColumns(int *state)`
- **功能**: 对 `state` 数组进行列混淆操作。
- **参数**:
  - `state`: 状态数组。
 
---

#### 9. `void invMixColumns(int *state)`
- **功能**: 对 `state` 数组进行逆列混淆操作。
- **参数**:
  - `state`: 状态数组。
 
---

#### 10. `int **expandKey(int *key)`
- **功能**: 将16位初始密钥扩展到48位以生成轮密钥。
- **参数**:
  - `key`: 初始密钥数组。
- **返回值**: 轮密钥数组（二维数组）。

---

#### 11. `void encrypt(int *state, int *key)`
- **功能**: 使用给定的密钥对 `state` 进行加密。
- **参数**:
  - `state`: 明文状态数组。
  - `key`: 密钥数组。
 
---

#### 12. `void decrypt(int *state, int *key)`
- **功能**: 使用给定的密钥对 `state` 进行解密。
- **参数**:
  - `state`: 密文状态数组。
  - `key`: 密钥数组。
 
---
 
### `main.cpp`中封装的函数

#### 1. `void test1()`
**功能**: 进行 16-bit 明文的加密。  
**参数**: 无  
**返回值**: 无  

---

#### 2. `void test2()`
**功能**: 进行 16-bit 密文的解密。  
**参数**: 无  
**返回值**: 无  

---

#### 3. `void changeTObinary(string a, int p[][16])`
**功能**: 将 ASCII 字符串转换为二维整数数组（每个字符转换为 8 位二进制，两个字符组成 16 位）。  
**参数**:  
- `string a`: 输入的 ASCII 字符串。  
- `int p[][16]`: 存储转换后的二进制数组。  
**返回值**: 无  

---

#### 4. `int changeTOasc(int c[], int begin, int end)`
**功能**: 将二维整数数组转换为 ASCII 字符串中的一个字符（8 位）。  
**参数**:  
- `int c[]`: 输入的二进制数组。  
- `int begin`: 开始索引。  
- `int end`: 结束索引。  
**返回值**: 转换后的 ASCII 字符（十进制表示）。  

---

#### 5. `void ascen(string plaintext, int key[])`
**功能**: 对输入的字符串进行加密。  
**参数**:  
- `string plaintext`: 输入的明文字符串。  
- `int key[]`: 加密使用的 16 位密钥。  
**返回值**: 无  

---

#### 6. `void ascde(int encrypted[][16], int key[], int size)`
**功能**: 对加密后的数组进行解密，并输出明文字符串。  
**参数**:  
- `int encrypted[][16]`: 加密后的二进制数组。  
- `int key[]`: 解密使用的 16 位密钥。  
- `int size`: 输入的加密块数量。  
**返回值**: 无  

---

#### 7. `void ctb(int decimal, int binary[])`
**功能**: 将十进制整数转换为二进制表示。  
**参数**:  
- `int decimal`: 输入的十进制数。  
- `int binary[]`: 存储转换后的二进制数组。  
**返回值**: 无  

---

#### 8. `int ctd(int binary[])`
**功能**: 将二进制数组转换为十进制整数。  
**参数**:  
- `int binary[]`: 输入的二进制数组。  
**返回值**: 转换后的十进制整数。  

---

#### 9. `void MitM(int plaintext[], int ciphertext[])`
**功能**: 实现中间相遇攻击算法，尝试暴力破解密钥。  
**参数**:  
- `int plaintext[]`: 输入的 16-bit 明文。  
- `int ciphertext[]`: 输入的 16-bit 密文。  
**返回值**: 无  

---

#### 10. `void test3()`
**功能**: 进行字符串的加密操作。  
**参数**: 无  
**返回值**: 无  

---

#### 11. `void test4()`
**功能**: 进行字符串的解密操作。  
**参数**: 无  
**返回值**: 无  

---

#### 12. `void test5()`
**功能**: 进行 16-bit 明文的双重加密。  
**参数**: 无  
**返回值**: 无  

---

#### 13. `void test6()`
**功能**: 进行 16-bit 密文的双重解密。  
**参数**: 无  
**返回值**: 无  

---

#### 14. `void test7()`
**功能**: 进行中间相遇攻击的操作。  
**参数**: 无  
**返回值**: 无  

---

#### 15. `void test8()`
**功能**: 进行 16-bit 明文的三重加密。  
**参数**: 无  
**返回值**: 无  

---

#### 16. `void test9()`
**功能**: 进行 16-bit 密文的三重解密。  
**参数**: 无  
**返回值**: 无  

---

#### 17. `void test10()`
**功能**: 实现 CBC 模式的加密。  
**参数**: 无  
**返回值**: 无  

---

#### 18. `void test11()`
**功能**: 实现 CBC 模式的解密。  
**参数**: 无  
**返回值**: 无  



# 用户指南
## 概述
重庆大学大数据与软件学院信息安全导论作业：S-AES算法的实现，根据老师课堂内容，使用CPP语言完成。
实现功能：二进制加解密，ASCLL码字符串加解密，二重加解，以及在已知明密文的前提下使用中间相遇攻击破解密钥，三重加解密，CBC模式下进行加密。

## 操作指南
下载main.cpp和S_AES.h文件，编译并运行main.cpp文件后进入初始界面。

### 初始界面
- 输入1/2，进行基础的16-bit数字加/解密。
- 输入3/4，进行字符串加/解密。
- 输入5/6，16-bit双重加/解密。
- 输入7，中间相遇攻击。
- 输入8/9，16-bit三重加/解密。
- 输入10/11，CBC加/解密。

### 注意

输入二进制密文/密钥/明文时，数字间需要带空格，错误输入请退出程序重新运行。

### 基础加解密
本功能只能进行16-bit的加解密，错误请重新运行程序并输入。
按照提示输入明/密文、密钥并回车即可。

### 字符串加解密
根据提示选择模式，并输入数据即可。
无长度限制。

### 双重加解密
根据提示输入16-bit明/密文，与32-bit密钥，回车即可。

### 中间相遇攻击

输入16-bit的明/密文对，回车等待破译即可，这通常需要花上几分钟时间。

### 三重加解密

按照提示输入明/密文、密钥并回车即可。

### CBC模式加解密

按照提示，分别需要输入：密文的bit长度(16的倍数)、密文、16-bit密钥、16-bit初始向量IV。
